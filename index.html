<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Finca La Herradura Â· Dashboard</title>
  <link rel="stylesheet" href="css/main.css" />
  <link rel="manifest" href="/manifest.json" />
</head>
<body>
  <!-- Indicador de conectividad -->
  <div id="connectivityIndicator" class="connectivity-indicator offline" aria-live="polite">
    <span class="connectivity-dot"></span>
    <span id="connectivityText">Sin Internet</span>
    <span id="pendingBadge" class="pending-badge hidden">0</span>
  </div>

  <main class="page dashboard-page">
    <header class="page-header">
      <h1>ğŸŒ¿ Finca La Herradura</h1>
      <p class="subtitle">Resumen del dÃ­a Â· ProducciÃ³n Â· Tanque Â· Precio MAGA Â· Ventas Â· Gastos</p>
    </header>

    <!-- KPIs -->
    <section class="stats-section">
      <div class="stat-card">
        <div class="stat-number" id="kpiUnits">0</div>
        <div class="stat-label">Unidades hoy</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="kpiTrees">0</div>
        <div class="stat-label">Ãrboles cosechados</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="kpiTank">100%</div>
        <div class="stat-label">Nivel del tanque</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="kpiMagaUnit">Q0.40</div>
        <div class="stat-label">Precio MAGA / unidad</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="kpiSales">Q0</div>
        <div class="stat-label">Ventas hoy</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="kpiExpenses">Q0</div>
        <div class="stat-label">Gastos hoy</div>
      </div>
    </section>

    <!-- Valor estimado (opcional pero Ãºtil) -->
    <section class="stats-section" style="margin-top:0;">
      <div class="stat-card" style="grid-column: span 2;">
        <div class="stat-number" id="kpiEstimate">Q0</div>
        <div class="stat-label">Valor estimado de la cosecha de hoy</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="kpiUpdated">â€”</div>
        <div class="stat-label">Actualizado</div>
      </div>
    </section>

    <!-- Accesos rÃ¡pidos -->
    <section class="form-section">
      <div class="card">
        <div class="card-header">
          <h2>âš¡ Acciones rÃ¡pidas</h2>
        </div>
        <div class="card-body">
          <div class="quick-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;">
            <a class="button primary" href="/produccion.html">ğŸŒ¿ Registrar Cosecha</a>
            <a class="button" href="/riegos.html">ğŸ’§ Programar Riego</a>
            <a class="button" href="/precios.html">ğŸ’° Ver Precios</a>
            <a class="button" href="/ventas.html">ğŸ§¾ Registrar Venta</a>
            <a class="button" href="/gastos.html">ğŸ“‰ Registrar Gasto</a>
            <a class="button" href="/tratamientos.html">ğŸ§ª Tratamientos</a>
            <a class="button" href="/arboles.html">ğŸŒ³ GestiÃ³n de Ãrboles</a>
            <button id="syncNowBtn" class="button">ğŸ”„ Sincronizar pendientes</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Recordatorios y alertas -->
    <section class="list-section">
      <div class="card">
        <div class="card-header">
          <h2>ğŸ”” Recordatorios importantes</h2>
        </div>
        <div class="card-body">
          <div id="remindersList" class="list">
            <!-- se llena dinÃ¡micamente -->
          </div>
        </div>
      </div>
    </section>

    <!-- Listado rÃ¡pido de eventos de hoy -->
    <section class="list-section">
      <div class="card">
        <div class="card-header">
          <h2>ğŸ“œ Hoy en la finca</h2>
        </div>
        <div class="card-body">
          <div class="list list-header">
            <div class="list-cell">Hora</div>
            <div class="list-cell">Tipo</div>
            <div class="list-cell">Detalle</div>
            <div class="list-cell">Valor</div>
          </div>
          <div id="todayFeed" class="list"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Firebase compat (CDN) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging-compat.js"></script>

  <!-- Config y offline -->
  <script src="/js/firebase-config.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/offline.js"></script>

    <!-- Botonera inferior comÃºn -->
  <script src="/js/nav.js"></script>

  <!-- LÃ³gica del dashboard -->
  <script src="/js/index.js"></script>



  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistration().then(reg => {
        if (!reg) navigator.serviceWorker.register('/sw.js').catch(console.error);
      });
    }
  </script>
</body>
</html>

